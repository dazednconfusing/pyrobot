<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Camera Calibration · PyRobot</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Camera Calibration"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Camera Calibration · PyRobot"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pyrobot.org/"/><meta property="og:description" content="## Camera Calibration"/><meta property="og:image" content="https://pyrobot.org/img/pyrobot_icon.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pyrobot.org/img/pyrobot_icon.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/pyrobot_icon.svg" alt="PyRobot"/><h2 class="headerTitleWithLogo">PyRobot</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/overview" target="_self">Tutorials</a></li><li class=""><a href="https://pyrobot-docs.readthedocs.io/en/latest/#" target="_self">API</a></li><li class="siteNavGroupActive"><a href="/docs/datasets" target="_self">Datasets</a></li><li class="siteNavGroupActive"><a href="/docs/faq" target="_self">Help</a></li><li class=""><a href="https://github.com/facebookresearch/pyrobot" target="_self">GitHub</a></li><li class=""><a href="https://pyrobot-next.readthedocs.io/en/api_0.4/" target="_self">next-API</a></li><li class=""><a href="https://github.com/facebookresearch/pyrobot/tree/API_0.4" target="_self">next-Github</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Locobot Examples</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/software">Install software</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Locobot Examples</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/calibration">[Basic] Camera Calibration</a></li><li class="navListItem"><a class="navItem" href="/docs/navigation">[Basic] Navigation</a></li><li class="navListItem"><a class="navItem" href="/docs/manipulation">[Basic] Manipulation</a></li><li class="navListItem"><a class="navItem" href="/docs/demonstrations">[Basic] Demonstration</a></li><li class="navListItem"><a class="navItem" href="/docs/pushing">[Basic] Pushing</a></li><li class="navListItem"><a class="navItem" href="/docs/active_camera">[Basic] Active Camera</a></li><li class="navListItem"><a class="navItem" href="/docs/grasping">[Advanced] Grasping</a></li><li class="navListItem"><a class="navItem" href="/docs/sim2real">[Advanced] Sim2Real</a></li><li class="navListItem"><a class="navItem" href="/docs/visual_nav_cmp">[Advanced] Visual Navigation (CMP)</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Sawyer Examples</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/manipulation_sawyer">[Basic] Manipulation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Help and Support</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/new_robot_support">New Robot Support</a></li><li class="navListItem"><a class="navItem" href="/docs/datasets">Datasets</a></li><li class="navListItem"><a class="navItem" href="/docs/network">Networking</a></li><li class="navListItem"><a class="navItem" href="/docs/contributing">Contributing to PyRobot</a></li><li class="navListItem"><a class="navItem" href="/docs/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/contact">Contact</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">The Next Version of PyRobot!</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/next-software">Install Software</a></li><li class="navListItem"><a class="navItem" href="/docs/next-manipulation">PyRobot Next Version Overview</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Camera Calibration</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="camera-calibration"></a><a href="#camera-calibration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Camera Calibration</h2>
<h3><a class="anchor" aria-hidden="true" id="setup"></a><a href="#setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setup</h3>
<p>Calibration depends upon <code>torch</code>, <code>torchvision</code>, <code>numpy</code> and <code>opencv-python</code>
packages. These should have been installed when you used the installation script to install <code>LoCoBot</code> and <code>PyRobot</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="run-calibration-one-time"></a><a href="#run-calibration-one-time" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run Calibration (One time)</h3>
<ol>
<li>Start all the ROS services.</li>
</ol>
<pre><code class="hljs"><span class="hljs-comment"># Launch the arm controllers, ar_tag tracker, etc. Make sure to specify the</span>
<span class="hljs-comment"># correct robot base (kobuki or create).</span>
roslaunch locobot_calibration calibrate.<span class="hljs-built_in">launch</span> base:=kobuki
</code></pre>
<ol start="2">
<li>Run script to collect data for calibration (should take about 10 minutes).
The robot will move the arm and camera around and record images and joint
angles. Keep robot arm workspace clear of obstacles.</li>
</ol>
<pre><code class="hljs">source ~<span class="hljs-string">/pyenv_pyrobot/bin/activate</span>
<span class="hljs-keyword">cd</span> ~<span class="hljs-string">/low_cost_ws/src/pyrobot/robots/LoCoBot/locobot_calibration/</span>

<span class="hljs-comment"># By default the calibration routine will use 6 fixed poses. You can modify</span>
<span class="hljs-comment"># these poses as necessary in scripts/collect_calibration_data.py</span>
python scripts/collect_calibration_data.py \
    <span class="hljs-params">--data_dir</span> tmp/calibration-data/v1/ \
    <span class="hljs-params">--botname</span> locobot
</code></pre>
<ol start="3">
<li>Run script to solve for calibration.</li>
</ol>
<pre><code class="hljs">python scripts/solve_for_calibration_params.py \
    <span class="hljs-params">--data_dir</span> tmp/calibration-data/v1/ \
    <span class="hljs-params">--calibration_output_file</span> ~<span class="hljs-string">/.robot/calibrated.json</span> \
    <span class="hljs-params">--overwrite</span> <span class="hljs-params">--n_iters</span> 10001 <span class="hljs-params">--to_optimize</span> camera_link
</code></pre>
<ul>
<li>Calibration solver setups up a least square pixel re-projection error
between the estimated location of the AR tag corners using the kinematic
chain, and the detected location of AR tag corners using basic image
processing.</li>
<li>Transforms listed in <code>scripts/solve_for_calibration_params.py</code> are
optimized using gradient descent (using Adam optimizer).</li>
<li>Calibration parameters are saved to <code>calibration_output_file</code>.</li>
<li>Note that the solver first optimizes for translation parameters and then
estimates both translation and rotation.</li>
<li>The solver prints out the pixel error. In practice, we have observed a
pixel error of upto <code>5</code> pixels gives reasonable performance. If the solver
is only able to converge to a larger error:
<ol>
<li>Verify the data being used for calibration (<code>data_dir</code> will contain a
directory <code>tag_detect</code> that will contain the images with the detected tag
corners, visually scan to make sure they are accurate and don't have too
many outliers),</li>
<li>Play around with the solver parameters (learning rate, Adam
parameters, robust loss parameters, etc.).</li>
<li>Additionally, also optimize for the <code>arm_base_link</code> transform. This
can be done using the <code>arm_base_link</code> to <code>--to_optimize</code> flag, as:
<code>--to_optimize camera_link,arm_base_link</code>.</li>
</ol></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="publish-estimated-transforms"></a><a href="#publish-estimated-transforms" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publish Estimated Transforms</h3>
<p>Running the following service will publish the estimated calibration
parameters. These will get incorporated in the ROS transform tree
automatically. This service must be run anytime the camera is used.
<strong>If you are using <code>locobot_control/main.launch</code>, this will be automatically launched and you do not have to run it separately.</strong></p>
<pre><code class="hljs">roslaunch locobot_calibration calibration_publish<span class="hljs-selector-class">.launch</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/software"><span class="arrow-prev">← </span><span>Install software</span></a><a class="docs-next button" href="/docs/navigation"><span>[Basic] Navigation</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#camera-calibration">Camera Calibration</a><ul class="toc-headings"><li><a href="#setup">Setup</a></li><li><a href="#run-calibration-one-time">Run Calibration (One time)</a></li><li><a href="#publish-estimated-transforms">Publish Estimated Transforms</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/pyrobot_icon.svg" alt="PyRobot" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/overview.html">Getting Started</a><a href="/docs/calibration.html">Examples</a><a href="/docs/datasets.html">Datasets</a><a href="/docs/new_robot_support.html">Help and Support</a></div><div><h5>More</h5><a href="https://github.com/facebookresearch/pyrobot">GitHub</a><a class="github-button" href="https://github.com/facebookresearch/pyrobot" data-icon="octicon-star" data-show-count="true" aria-label="Star facebookresearch/pyrobot on GitHub">Star</a><a href="/docs/contact.html">Contact</a></div></section></footer></div></body></html>